
<!-- /app/common/
@{ngCommon('swap')} -->
@{import('ui-bootstrap-tpls-0.14.3.min.js', 'angular/angular-ui-router.js', 'angular/angular-animate.js', 'angular/angular-sanitize.js', 'd3js/d3.v3.js', 'd3js/c3.js', 'd3js/angular-chart.js', 'ngToast.min.js', 'angucomplete-alt.js', 'splash.js')}

<!-- /app/css/ -->
@{ngStyle('app', 'app-mobile')}

<!-- /app/controllers/ -->
@{ngController('domotix')}

<!-- /app/filters/ -->
@{ngFilter('filters')}

<toast></toast>

<div>
  <h1 class="display-1 xirod"><img src="domotix.ico" /> Domotix</h1>
</div>

<div ng-controller="DomotixCtrl" class="container">
  <div class="tab-pane">
    <ul class="nav nav-tabs">
      <li class="nav-item" ng-repeat="level in levels" title="{{level.name}}">
        <a href="#level_{{level.id}}" class="nav-link" ng-class="{'active': level.id==2}" role="tab" data-toggle="tab">{{level.name}}</a>
      </li>
    </ul>
    <div class="tab-content">
      <div ng-repeat="level in levels" id="level_{{level.id}}" role="tabpanel" class="tab-pane" ng-class="{'active': level.id==2}">
        <svg viewBox="0 0 1200 1200" version="1.1" width="1200px" height="1200px" ng-click="handleSvgClick($event, level)">
          <defs>
            <circle id="l1" cx="0" cy="0" r="50" stroke-width="0"></circle>
            <rect id="l2" x="-25" y="-25" width="50" height="50" stroke-width="0"></rect>
            <radialGradient id="g1" cx="50%" cy="50%" r="50%">
              <stop stop-color="grey" offset="0%"></stop>
              <stop stop-color="white" offset="100%"></stop>
            </radialGradient>
            <radialGradient id="g2" cx="50%" cy="50%" r="50%">
              <stop stop-color="black" offset="0%"></stop>
              <stop stop-color="teal" offset="50%"></stop>
              <stop stop-color="white" offset="100%"></stop>
            </radialGradient>
          </defs>
          <path id="level{{level.id}}" d="{{level.path}}" fill="white" stroke="#428bca" stroke-width="6"></path>
          <g ng-repeat="room in level.rooms">
            <path id="room{{room.id}}" d="{{room.path}}" fill="white" stroke="#428bca" stroke-width="3"></path>
            
            <use ng-repeat="light in room.lights" id="light-{{light.swapDeviceAddress}}-{{light.outputNb}}" 
              x="{{lightPosition(room, light)[0]}}" y="{{lightPosition(room, light)[1]}}" 
              xlink:href="{{lightDef(room, light)}}" fill="{{lightFill(room, light)}}" transform="{{lightTransform(room, light)}}"></use>
            
            <g ng-repeat="light in room.lights">
              <circle cx="{{lightPosition(room, light)[0]}}" cy="{{lightPosition(room, light)[1]}}" r="50" stroke="red" stroke-width="1" style="fill-opacity: 0;"></circle>
              <circle cx="{{lightPosition(room, light)[0]}}" cy="{{lightPosition(room, light)[1]}}" r="75" stroke="red" stroke-width="1" style="fill-opacity: 0;"></circle>
              <circle cx="{{lightPosition(room, light)[0]}}" cy="{{lightPosition(room, light)[1]}}" r="100" stroke="red" stroke-width="1" style="fill-opacity: 0;"></circle>
            </g>
            
            <g ng-repeat="device in devices | objectToArray | filter: { location: { room_id: room.id }}">
              <text x="{{devicePosition(device)[0]}}" y="{{devicePosition(device)[1]}}" ng-show="device.temperature">{{device.temperature.value}}</text>
              <text x="{{devicePosition(device)[0]}}" y="{{devicePosition(device)[1] + 20}}" ng-show="device.pressure">{{device.pressure.value}}</text>
            </g>
          </g>
        </svg>
      </div>
    </div>
  </div>
</div>